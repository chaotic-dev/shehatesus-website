<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>She HATES Us</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Does your oshi HATE you? Find out here!">
  <link rel="stylesheet" href="style.css">
  <link rel="icon"
    href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB5PSIuOWVtIiBmb250LXNpemU9IjkwIj7wn5KUPC90ZXh0Pjwvc3ZnPg==">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap"
    rel="stylesheet">
</head>

<body>
  <div id="error"></div>
  <h1 id="title">Loading...</h1>
  <img id="profile-pic" src="" alt="profile picture" width="240" height="240">
  <p id="details">Loading...</p>
</body>

<script>
  window.onload = (event) => {
    const urlParams = new URLSearchParams(window.location.search);
    fetch(`https://api.shehates.us/late?${urlParams}`)
      .then(response => {
        if (!response.ok) {
          throw new Error(`Response status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        if ("error" in data) {
          throw new Error(`Server error: ${data.error}`);
        }
        let title;
        let details;
        switch (data.live_status) {
          case "UNKNOWN":
            title = `${data.channel_name} does not have any scheduled streams within the next <strong>WEEK</strong>!`
            details = "She <strong>PROBABLY</strong> hates you!"
            break
          case "LIVE":
            title = `${data.channel_name} is <strong>LIVE</strong> right now!`
            details = "She <strong>LOVES</strong> you!"
            break;
          case "UPCOMING":
            title = `${data.channel_name} has an <strong>UPCOMING</strong> stream and isn't late!`
            details = "She <strong>PROBABLY</strong> loves you!"
            break;
          case "LATE":
            title = `${data.channel_name} is <strong>LATE</strong> for her stream!`
            details = "She <strong>HATES</strong> you!"
          default:
            title = `${data.channel_name} is doing... <strong>SOMETHING</strong>?`
            details = "We don't know what it is, but she <strong>PROBABLY</strong> still hates you!"
        }
        document.getElementById("title").innerHTML = title;
        document.getElementById("details").innerHTML = details;
        document.getElementById("profile-pic").setAttribute("src", data.profile_pic.url)
      })
      .catch(error => {
        const errorDiv = document.getElementById("error");
        errorDiv.innerHTML = error;
        errorDiv.style.display = "block";
        console.log(error);
        document.getElementById("profile-pic").setAttribute("src", "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB5PSIuOWVtIiBmb250LXNpemU9IjkwIj7wn6ulPC90ZXh0Pjwvc3ZnPg==")
      });
  }
</script>

</html>